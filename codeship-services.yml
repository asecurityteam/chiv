test:
  build: .
  cached: true
  environment:
    - AWS_ACCESS_KEY_ID=bogus
    - AWS_SECRET_KEY=bogus
    - AWS_REGION=us-east-1
    - AWS_ENDPOINT=http://s3:4572
    - POSTGRES_URL=postgres://postgres:password@postgres/test?sslmode=disable
  depends_on:
    - postgres
    - s3

lint:
  build: .
  cached: true

postgres:
  image: postgres:11.2
  environment:
    - POSTGRES_DB=test
    - POSTGRES_PASSWORD=password
  cached: true

s3:
  image: localstack/localstack:0.9.0
  environment:
    - SERVICES=s3
  cached: true